(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('axios')) :
    typeof define === 'function' && define.amd ? define(['exports', 'axios'], factory) :
    (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global.pglyWps029 = {}, global.axios));
})(this, (function (exports, axios) { 'use strict';

    function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

    var axios__default = /*#__PURE__*/_interopDefaultLegacy(axios);

    var extendStatics=function(t,e){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e;}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);},extendStatics(t,e)};function __extends(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t;}extendStatics(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r);}var __assign=function(){return __assign=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},__assign.apply(this,arguments)};function __awaiter(t,e,r,n){return new(r||(r=Promise))((function(o,a){function i(t){try{u(n.next(t));}catch(t){a(t);}}function c(t){try{u(n.throw(t));}catch(t){a(t);}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e);}))).then(i,c);}u((n=n.apply(t,e||[])).next());}))}function __generator(t,e){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i);}catch(t){a=[6,t],n=0;}finally{r=o=0;}if(5&a[0])throw a[1];return {value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}

    var has=Object.prototype.hasOwnProperty,qsStringify=function o(e,r){var t=[];for(var n in e)if(has.call(e,n)){var s,p=e[n],a=encodeURIComponent(n);s="object"==typeof p?o(p,r?r+"["+a+"]":a):(r?r+"["+a+"]":a)+"="+encodeURIComponent(p),t.push(s);}return t.join("&")};

    var DOMManipulation=function(){function n(){}return n.getElement=function(n){if("string"==typeof n){var e=document.getElementById(n);if(!e)throw new Error("Cannot find element id #"+n+" on DOM...");return e}return n},n.findElement=function(n,e){var t=n.querySelector(e);if(!e)throw new Error("Cannot find element with query "+e+" on wrapper...");return t},n.createHiddenInput=function(n,e,t){var r=document.createElement("input");return r.type="hidden",r.name=e,r.value=t,n.appendChild(r),r},n}();

    var EventHandler=function(){function t(){this.events={};}return t.prototype.on=function(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e);},t.prototype.remove=function(t,e){this.events[t]&&(this.events[t]=this.events[t].filter((function(t){return t!==e})));},t.prototype.removeAll=function(t){this.events[t]=[];},t.prototype.emit=function(t,e){var n=this;this.events[t]&&this.events[t].forEach((function(t){t.call(n,e);}));},t}();

    var ValidatorEngine=function(){function n(){}return n.apply=function(n,t,a,r){try{n.forEach((function(n){return n(t)})),r();}catch(n){a(n.message);}},n}();

    var PglyFieldError=function(){function t(t,e){this._state=!1,this._parent=t,this._comp={wrapper:e,message:DOMManipulation.findElement(e,".pgly-wps--message")};}return t.prototype.apply=function(t){this._state=!0,this._message=t,this._emit("error");},t.prototype.flush=function(){this._state=!1,this._message=void 0,this._emit("errorFlush");},t.prototype.has=function(){return this._state},t.prototype.message=function(){return this._message},t.prototype._render=function(){var t;this._comp.wrapper.classList.remove("pgly-wps--error"),this._state&&this._comp.wrapper.classList.add("pgly-wps--error"),this._comp.message.textContent=null!==(t=this._message)&&void 0!==t?t:"";},t.prototype._emit=function(t){this._render(),this._parent.emit(t,{component:this._parent,state:this._state,message:this._message});},t}();

    var PglyField=function(){function t(t,e,n){this._parent=t,this._value=n,this._name=e;}return t.prototype.name=function(){return this._name},t.prototype.label=function(){return this._label},t.prototype.set=function(t,e){this._value=t,this._label=e,this._parent.emit("change",{component:this._parent,value:this._value,label:this._label});},t.prototype.get=function(){return this._value},t}();

    var PglyBaseComponent=function(r){function e(e){var t=r.call(this)||this;t._wrapper=DOMManipulation.getElement(e);var n=t._wrapper.dataset.name;if(!n)throw console.error("Wrapper has no data-name attribute",t._wrapper),new Error("PglyBaseComponent.PglyField must have a data-name attribute in its wrapper...");return t._error=new PglyFieldError(t,t._wrapper),t._field=new PglyField(t,n,void 0),t}return __extends(e,r),e.prototype.error=function(){return this._error},e.prototype.field=function(){return this._field},e.prototype.validate=function(r){var e=this;ValidatorEngine.apply(r,this._field.get(),(function(r){return e._error.apply(r)}),(function(){return e._error.flush()}));},e}(EventHandler);

    var PglyCheckboxComponent=function(t){function e(e){var o=t.call(this,e)||this;return o._checkbox=DOMManipulation.findElement(o._wrapper,".pgly-wps--checkbox"),o._bind(),o._default(),o}return __extends(e,t),e.prototype.emptyValue=function(){this.field().set(!1);},e.prototype._select=function(t){this._checkbox.classList.remove("pgly-checked--state"),t&&this._checkbox.classList.add("pgly-checked--state");},e.prototype._bind=function(){var t=this;this.on("change",(function(e){var o=e.value;t._select(o);})),this._checkbox.addEventListener("click",(function(){t.field().set(!t.field().get());}));},e.prototype._default=function(){this.field().set("true"===this._checkbox.dataset.value);},e}(PglyBaseComponent);

    var PglyInputComponent=function(t){function e(e){var n=t.call(this,e)||this;return n._keyEvent=!1,n._input=DOMManipulation.findElement(n._wrapper,"input"),n._bind(),n._default(),n}return __extends(e,t),e.prototype.emptyValue=function(){this.field().set("");},e.prototype._bind=function(){var t=this;this.on("change",(function(){t._keyEvent||(t._input.value=t.field().get());})),this._input.addEventListener("keyup",(function(e){t._keyEvent=!0,t._field.set(e.target.value),t._keyEvent=!1;}));},e.prototype._default=function(){this.field().set(this._input.value);},e}(PglyBaseComponent);

    var PglyTextAreaComponent=function(t){function e(e){var n=t.call(this,e)||this;return n._keyEvent=!1,n._input=DOMManipulation.findElement(n._wrapper,"textarea"),n._bind(),n._default(),n}return __extends(e,t),e.prototype.emptyValue=function(){this.field().set("");},e.prototype._bind=function(){var t=this;this.on("change",(function(){t._keyEvent||(t._input.value=t.field().get());})),this._input.addEventListener("keyup",(function(e){t._keyEvent=!0,t._field.set(e.target.value),t._keyEvent=!1;}));},e.prototype._default=function(){this.field().set(this._input.value);},e}(PglyBaseComponent);

    var PglyLoadable=function(){function o(o){this._loading=!1,this._parent=o;}return o.prototype.prepare=function(o){void 0===o&&(o=void 0),this._parent.emit("beforeLoad",{loading:!1,payload:o}),this._loading=!0;},o.prototype.done=function(o){void 0===o&&(o=void 0),this._loading=!1,this._parent.emit("afterLoad",{loading:!1,payload:o});},o.prototype.isLoading=function(){return this._loading},o}();

    var PglySelectComponent=function(e){function t(t){var i=e.call(this,t)||this;return i.items=[],i._comps={selection:DOMManipulation.findElement(i._wrapper,".selected"),value:DOMManipulation.findElement(i._wrapper,".selected span"),items:DOMManipulation.findElement(i._wrapper,".items"),container:DOMManipulation.findElement(i._wrapper,".items .container")},i._loader=new PglyLoadable(i),i._options={labels:{placeholder:"Select an option..."}},i._bind(),i._default(),i}return __extends(t,e),t.prototype.options=function(e){this._options=__assign(__assign({},this._options),e);},t.prototype.loader=function(){return this._loader},t.prototype.synchronous=function(e){this.loader().prepare(),this.items=e,this._render(),this.loader().done();},t.prototype.asynchronous=function(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(i){switch(i.label){case 0:return this.loader().prepare(),t=this,[4,e()];case 1:return t.items=i.sent(),this._render(),this.loader().done(),[2]}}))}))},t.prototype.emptyValue=function(){this.field().set("","");},t.prototype.cleanItems=function(){this.items=[],this._render();},t.prototype.reflect=function(e,t){var i=this;this.on("change",(function(o){var s=o.value;e.emptyValue(),t[s]&&(e.field().set(t[s][0].value,t[s][0].label),e.synchronous(t[s]),i.emit("reflectedTo",{origin:i,destination:e,values:t[s]}));}));},t.prototype._flush=function(){var e=this;this._comps.items.querySelectorAll(".item").forEach((function(t){t.classList.remove("current"),t.dataset.value===e.field().get()&&t.classList.add("current");}));},t.prototype._toggle=function(){this._comps.selection.classList.toggle("open"),this._comps.items.classList.toggle("hidden");},t.prototype._close=function(){this._comps.selection.classList.remove("open"),this._comps.items.classList.add("hidden");},t.prototype._renderSelection=function(){var e,t;""!==this.field().get()?this._comps.selection.classList.remove("empty"):this._comps.selection.classList.add("empty"),this._comps.value.textContent=null!==(t=null!==(e=this.field().label())&&void 0!==e?e:this._options.labels.placeholder)&&void 0!==t?t:"",this._flush(),this._close();},t.prototype._render=function(){for(var e=this;this._comps.container.firstChild;)this._comps.container.removeChild(this._comps.container.firstChild);this.items.forEach((function(t){var i,o=document.createElement("div");o.className="item",o.dataset.value=t.value,o.textContent=t.label,t.selected&&(o.className+=" current",e.field().set(t.value,t.label),e._comps.selection.classList.remove("empty"),e._comps.value.textContent=null!==(i=e.field().label())&&void 0!==i?i:""),e._comps.container.appendChild(o);}));},t.prototype._bind=function(){var e=this;this.on("beforeLoad",(function(){e._comps.selection.classList.add("pgly-loading--state");})),this.on("afterLoad",(function(){e._comps.selection.classList.remove("pgly-loading--state");})),this.on("change",(function(){e._renderSelection();})),this._comps.selection.addEventListener("click",(function(){e.loader().isLoading()||e._toggle();})),this._comps.items.addEventListener("click",(function(t){var i,o;if(!e.loader().isLoading()){var s=t.target;if(s&&(t.preventDefault(),s.classList.contains("item")||s.classList.contains("clickable"))){var n=null!==(i=s.dataset.value)&&void 0!==i?i:"",a=null!==(o=s.textContent)&&void 0!==o?o:"";e.field().set(n,a);}}}));},t.prototype._default=function(){this._comps.selection.dataset.value&&this.field().set(this._comps.selection.dataset.value,this._comps.selection.dataset.label);},t}(PglyBaseComponent);

    var PglyFinderComponent=function(e){function t(t){var s=e.call(this,t)||this;return s._options={labels:{select:"Select",unselect:"Unselect"}},s._search={wrapper:DOMManipulation.findElement(s._wrapper,".pgly-wps--field .pgly-wps--input"),input:DOMManipulation.findElement(s._wrapper,".pgly-wps--field input"),button:DOMManipulation.findElement(s._wrapper,".pgly-wps--field button")},s._selected={wrapper:DOMManipulation.findElement(s._wrapper,".pgly-wps--field .pgly-wps--selected"),label:DOMManipulation.findElement(s._wrapper,".pgly-wps--field .pgly-wps--selected .pgly-wps--label"),button:DOMManipulation.findElement(s._wrapper,".pgly-wps--field .pgly-wps--selected button")},s._items={loader:s._wrapper.querySelector(".pgly-wps--loader"),list:s._wrapper.querySelector(".pgly-wps--loader .pgly-wps--list")},s._response=[],s._loader=new PglyLoadable(s),s._bind(),s._default(),s}return __extends(t,e),t.prototype.options=function(e){this._options=__assign(__assign({},this._options),e);},t.prototype.loader=function(){return this._loader},t.prototype.emptyValue=function(){this.field().set("","");},t.prototype._select=function(){var e=""!==this.field().get();this._selected.label.textContent=this.field().label(),this._search.input.value="",void 0!==e&&this._flush(),this._search.wrapper.style.display=e?"none":"flex",this._selected.wrapper.style.display=e?"flex":"none";},t.prototype._flush=function(){for(;this._items.list.firstChild;)this._items.list.removeChild(this._items.list.firstChild);},t.prototype.load=function(){return __awaiter(this,void 0,void 0,(function(){var e,t=this;return __generator(this,(function(s){switch(s.label){case 0:if(0===this._search.input.value.length||this.loader().isLoading()||!this._options.load)return [2];this.loader().prepare(),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this._options.load(this._search.input.value)];case 2:return e=s.sent(),[3,4];case 3:return s.sent(),this.loader().done(),[2];case 4:return this._flush(),e.forEach((function(e){t._items.list.appendChild(t._render(e));})),this.loader().done(),[2]}}))}))},t.prototype._bind=function(){var e=this;this.on("change",(function(){e._select();})),this.on("beforeLoad",(function(){e._search.button.classList.add("pgly-loading--state"),e._items.loader.classList.add("pgly-loading--state");})),this.on("afterLoad",(function(){e._search.button.classList.remove("pgly-loading--state"),e._items.loader.classList.remove("pgly-loading--state");})),this._search.button.addEventListener("click",(function(t){t.preventDefault(),e.load();})),this._selected.button.addEventListener("click",(function(t){return t.preventDefault(),e.currIndex=void 0,e.field().set("","")})),this._items.list.addEventListener("click",(function(t){var s=t.target;if(t.preventDefault(),s.classList.contains("pgly-wps--button")){var l=s.dataset,i=l.label,a=void 0===i?"":i,n=l.value,o=void 0===n?"":n;e.field().set(o,a);}})),this._search.input.addEventListener("keypress",(function(t){var s=t.key||t.keyCode;"Enter"!==s&&13!==s||(t.preventDefault(),e.load());}));},t.prototype._render=function(e){var t,s,l=document.createElement("div");l.className="pgly-wps--row";var i=document.createElement("div");i.className="pgly-wps--column pgly-wps-col--12 pgly-wps-is-compact";var a=document.createElement("div");a.className="pgly-wps--card pgly-wps-is-white pgly-wps-is-compact";var n=document.createElement("div");n.className="inside left",n.textContent=e.label;var o=document.createElement("div");o.className="pgly-wps--action-bar inside right";var p=document.createElement("button");return p.className="pgly-wps--button pgly-wps-is-compact pgly-wps-is-primary",p.textContent=null!==(s=null===(t=this._options.labels)||void 0===t?void 0:t.select)&&void 0!==s?s:"Select",p.dataset.label=e.label,p.dataset.value=e.value,o.appendChild(p),a.appendChild(n),a.appendChild(o),i.appendChild(a),l.appendChild(i),l},t.prototype._default=function(){this._selected.wrapper.dataset.value&&this.field().set(this._selected.wrapper.dataset.value,this._selected.wrapper.dataset.label);},t}(PglyBaseComponent);

    var PglySingleMediaComponent=function(t){function e(e){var n=t.call(this,e)||this;return n._options={labels:{title:"Select a media",button:"Select"}},n._image=DOMManipulation.findElement(n._wrapper,"img"),n._bind(),n._default(),n}return __extends(e,t),e.prototype.options=function(t){this._options=__assign(__assign({},this._options),t);},e.prototype.select=function(t){this.field().set(t.value,t.src);},e.prototype.clean=function(){this.field().set("","");},e.prototype.emptyValue=function(){this.clean();},e.prototype._bind=function(){var t=this;this.on("change",(function(){var e;t._image.src=null!==(e=t.field().label())&&void 0!==e?e:"";})),this._wrapper.addEventListener("click",(function(e){var n=e.target;n&&(e.preventDefault(),n.classList.contains("pgly-wps--select")?t.emit("select",{component:t}):n.classList.contains("pgly-wps--clean")&&(t.emit("clean",{component:t}),t.clean()));}));},e.prototype._default=function(){this._image.dataset.value&&this.field().set(this._image.dataset.value,this._image.dataset.src);},e.wpFrame=function(t){var e=t.component,n=wp.media.frames.metaImageFrame=wp.media({title:e._options.labels.title,library:{type:"image"},button:{text:e._options.labels.button},multiple:!1});n.on("open",(function(){var t=e.field().get();if(t&&!(t.length<=0)){var i=n.state().get("selection"),a=wp.media.attachment(t);a.fetch(),i.add(a?[a]:[]);}})),n.on("select",(function(){var t=n.state().get("selection").first().toJSON(),i=t.id,a=t.url;e.select({value:i,src:a});})),n.open();},e}(PglyBaseComponent);

    var PglyMultipleMediaComponent=function(e){function t(t){var i=e.call(this,t)||this;return i._images=DOMManipulation.findElement(i._wrapper,".pgly-wps--images"),i._options={labels:{title:"Select a media",button:"Select"}},i.field().set([]),i._bind(),i._default(),i}return __extends(t,e),t.prototype.options=function(e){this._options=__assign(__assign({},this._options),e);},t.prototype.select=function(e){this.field().get().push(e.value),this._render(e);},t.prototype.remove=function(e){var t=document.getElementById(this.field().name()+"-img-"+e);t&&(this._images.removeChild(t),this.field().set(this.field().get().filter((function(t){return t!=e}))));},t.prototype.clean=function(){for(this.field().set([]);this._images.firstChild;)this._images.removeChild(this._images.firstChild);},t.prototype.emptyValue=function(){this.clean();},t.prototype._render=function(e){var t=document.createElement("div");t.id=this.field().name()+"-img-"+e.value,t.className="pgly-wps--image",t.style.backgroundImage="url("+e.src+")";var i=document.createElement("button");i.className="pgly-wps--icon-button pgly-wps--remove pgly-wps-is-compact pgly-wps-is-rounded pgly-wps-is-danger pgly-wps--close",i.dataset.value=e.value,t.appendChild(i),this._images.appendChild(t);},t.prototype._bind=function(){var e=this;this._wrapper.addEventListener("click",(function(t){var i=t.target;if(i){if(t.preventDefault(),i.classList.contains("pgly-wps--remove")){var s=i.dataset.value,a=void 0===s?"":s;return e.emit("remove",{component:e,value:a}),void e.remove(a)}i.classList.contains("pgly-wps--select")?e.emit("select",{component:e}):i.classList.contains("pgly-wps--clean")&&(e.emit("clean",{component:e}),e.clean());}}));},t.wpFrame=function(e){var t=e.component,i=wp.media.frames.metaImageFrame=wp.media({title:t._options.labels.title,library:{type:"image"},button:{text:t._options.labels.button},multiple:!0});i.on("open",(function(){var e;null===(e=t.field().get())||void 0===e||e.forEach((function(e){var t=i.state().get("selection"),s=wp.media.attachment(e);s.fetch(),t.add(s?[s]:[]);}));})),i.on("select",(function(){for(var e=i.state().get("selection").map((function(e){return e.toJSON()}));t._images.firstChild;)t._images.removeChild(t._images.firstChild);t.field().set([]),e.forEach((function(e){t.select({value:e.id,src:e.url});}));})),i.open();},t.prototype._default=function(){var e=this;if(this._images.dataset.values&&this._images.dataset.srcs){var t=this._images.dataset.values.split(","),i=this._images.dataset.srcs.split(",");this.field().set(t),t.forEach((function(t,s){var a;e._render({value:t,src:null!==(a=i[s])&&void 0!==a?a:""});}));}},t}(PglyBaseComponent);

    var UUID=function(){function t(){}return t.generate=function(){if(0===t.lut.length)for(var u=0;u<256;u++)t.lut[u]=(u<16?"0":"")+u.toString(16);var l=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0,a=4294967295*Math.random()|0;return t.lut[255&l]+t.lut[l>>8&255]+t.lut[l>>16&255]+t.lut[l>>24&255]+"-"+t.lut[255&n]+t.lut[n>>8&255]+"-"+t.lut[n>>16&15|64]+t.lut[n>>24&255]+"-"+t.lut[63&r|128]+t.lut[r>>8&255]+"-"+t.lut[r>>16&255]+t.lut[r>>24&255]+t.lut[255&a]+t.lut[a>>8&255]+t.lut[a>>16&255]+t.lut[a>>24&255]},t.lut=[],t}();

    var PglyBasicSelectComponent=function(e){function t(t){var n=e.call(this,t)||this;return n._changeEvent=!1,n._input=DOMManipulation.findElement(n._wrapper,"select"),n._loader=new PglyLoadable(n),n._bind(),n._default(),n}return __extends(t,e),t.prototype.loader=function(){return this._loader},t.prototype.synchronous=function(e){this.loader().prepare(),this._render(e),this.loader().done();},t.prototype.asynchronous=function(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return this.loader().prepare(),t=this._render,[4,e()];case 1:return t.apply(this,[n.sent()]),this.loader().done(),[2]}}))}))},t.prototype.emptyValue=function(){this.field().set("");},t.prototype.cleanItems=function(){this._render([]);},t.prototype.reflect=function(e,t){var n=this;this.on("change",(function(i){var o=i.value;e.emptyValue(),t[o]&&(e.field().set(t[o][0].value,t[o][0].label),e.synchronous(t[o]),n.emit("reflectedTo",{origin:n,destination:e,values:t[o]}));}));},t.prototype._render=function(e){for(var t=this,n=DOMManipulation.findElement(this._input,".placeholder");this._input.firstChild;)this._input.removeChild(this._input.firstChild);n&&this._input.appendChild(n),e.forEach((function(e){var n=document.createElement("option");n.value=e.value,n.textContent=e.label,e.selected&&(n.selected=!0),t._input.appendChild(n);}));},t.prototype._bind=function(){var e=this;this.on("beforeLoad",(function(){e._input.disabled=!0;})),this.on("afterLoad",(function(){e._input.disabled=!1;})),this.on("change",(function(){e._changeEvent||(e._input.value=e.field().get());})),this._input.addEventListener("change",(function(t){e._changeEvent=!0,e._field.set(t.target.value),e._changeEvent=!1;}));},t.prototype._default=function(){this.field().set(this._input.value);},t}(PglyBaseComponent);

    var PglyGroupFormItems=function(){function t(t){this._items=[],this._parent=t;}return t.prototype.count=function(){return this._items.length},t.prototype.add=function(t,e){void 0===e&&(e="add"),this._items.push(t),this._parent.emit("added",{item:t,origin:e});},t.prototype.get=function(t){return this._items.find((function(e){return e.uid===t}))},t.prototype.all=function(){return this._items.map((function(t){var e=__assign({},t.inputs);return Object.keys(e).forEach((function(t){e[t]=e[t].value;})),e}))},t.prototype.updateId=function(t,e,i){void 0===i&&(i="updateId");var n=this._items.find((function(e){return e.uid===t}));n&&(n.inputs.id={value:e},this._parent.emit("updatedId",{item:n,origin:i}));},t.prototype.update=function(t,e){var i=this;void 0===e&&(e="update");var n=this._items.findIndex((function(e){return e.uid===t.uid}));n<0||(Object.keys(t.inputs).forEach((function(e){i._items[n].inputs[e]=t.inputs[e];})),this._parent.emit("updated",{item:this._items[n],origin:e}));},t.prototype.remove=function(t,e){void 0===e&&(e="remove");var i=this._items.find((function(e){return e.uid===t}));i&&(this._items=this._items.filter((function(e){return e.uid!==t})),this._parent.emit("removed",{item:i,origin:e}));},t}();var PglyGroupFormComponent=function(t){function e(e){var i=t.call(this,e)||this;return i._inputs={},i._items=new PglyGroupFormItems(i),i._loader=new PglyLoadable(i),i._editing=!1,i._current=void 0,i._comps={items:DOMManipulation.findElement(i._wrapper,".pgly-wps--items")},i._options={view:{},labels:{edit:"Edit",remove:"Remove"}},i._bind(),i}return __extends(e,t),e.prototype.groupEl=function(){return this._wrapper},e.prototype.dataset=function(){return this._wrapper.dataset},e.prototype.options=function(t){this._options=__assign(__assign({},this._options),t);},e.prototype.loader=function(){return this._loader},e.prototype.items=function(){return this._items},e.prototype.add=function(t){this._inputs[t.field().name()]=t;},e.prototype.synchronous=function(t){var e=this;this.loader().prepare({action:"items"}),t.forEach((function(t){return e._items.add({uid:UUID.generate(),inputs:t},"load")})),this.loader().done({action:"items"});},e.prototype.asynchronous=function(t){return __awaiter(this,void 0,void 0,(function(){var e,i=this;return __generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),this.loader().prepare({action:"items"}),[4,t()];case 1:return n.sent().forEach((function(t){return i._items.add({uid:UUID.generate(),inputs:t},"load")})),[3,3];case 2:return e=n.sent(),this.emit("loadError",{error:e}),[3,3];case 3:return this.loader().done({action:"items"}),[2]}}))}))},e.prototype.get=function(t){return this._inputs[t]},e.prototype.remove=function(t){delete this._inputs[t];},e.prototype.auto=function(){var t=this,e="pgly-gform";this._wrapper.querySelectorAll(".pgly-gform--input").forEach((function(i){if(i.classList.contains(e+"--text")){var n=(d=new PglyInputComponent(i)).field().name();t._inputs[n]=d;}else if(i.classList.contains(e+"--textarea")){var o=(d=new PglyTextAreaComponent(i)).field().name();t._inputs[o]=d;}else if(i.classList.contains(e+"--checkbox")){var s=(d=new PglyCheckboxComponent(i)).field().name();t._inputs[s]=d;}else if(i.classList.contains(e+"--select")){var r=(d=new PglyBasicSelectComponent(i)).field().name();t._inputs[r]=d;}else if(i.classList.contains(e+"--eselect")){var a=(d=new PglySelectComponent(i)).field().name();t._inputs[a]=d;}else if(i.classList.contains(e+"--finder")){var p=(d=new PglyFinderComponent(i)).field().name();t._inputs[p]=d;}else if(i.classList.contains(e+"--single-media")){var l=(d=new PglySingleMediaComponent(i)).field().name();t._inputs[l]=d;}else if(i.classList.contains(e+"--multiple-media")){var d,u=(d=new PglyMultipleMediaComponent(i)).field().name();t._inputs[u]=d;}}));},e.prototype.prepare=function(t){var e=this;void 0===t&&(t={});var i={},n=[];return Object.keys(this._inputs).forEach((function(o){var s=e._inputs[o];t[s.field().name()]&&(s.validate(t[s.field().name()]),s.error().has()&&n.push({name:s.field().name(),value:s.field().get(),message:s.error().message()})),i[s.field().name()]={label:s.field().label(),value:s.field().get()};})),{inputs:i,errors:n}},e.prototype.emptyValue=function(){throw new Error("Not implemented")},e.prototype._submit=function(t){if(!this._loader.isLoading())if(0===t.errors.length){if(this._editing){if(this._current){this._items.update({uid:this._current,inputs:t.inputs});var e=DOMManipulation.findElement(this._comps.items,'.pgly-wps--card[data-uid="'+this._current+'"]');e&&e.classList.remove("pgly-wps-is-warning");}}else this._items.add({uid:UUID.generate(),inputs:t.inputs});this._editing=!1,this._current=void 0,this._flushInputs();}else this.emit("error",{data:t.errors});},e.prototype._cancel=function(){if(this._current){var t=DOMManipulation.findElement(this._comps.items,'.pgly-wps--card[data-uid="'+this._current+'"]');t&&t.classList.remove("pgly-wps-is-warning");}this._editing=!1,this._current=void 0,this._flushInputs();},e.prototype._flushInputs=function(){var t=this;Object.keys(this._inputs).forEach((function(e){t._inputs[e].emptyValue();}));},e.prototype._updateInputs=function(t){var e,i=this,n=null===(e=this._items.get(t))||void 0===e?void 0:e.inputs;if(n){Object.keys(n).forEach((function(t){var e=i._inputs[t];e&&e.field().set(n[t].value,n[t].label);}));var o=DOMManipulation.findElement(this._comps.items,'.pgly-wps--card[data-uid="'+t+'"]');o&&o.classList.add("pgly-wps-is-warning");}},e.prototype._addCard=function(t){var e=this,i=document.createElement("div");i.className="pgly-wps--card pgly-wps-is-white pgly-wps-is-compact",i.dataset.uid=t.uid;var n=document.createElement("div");n.className="pgly-wps--content inside left",Object.keys(t.inputs).forEach((function(i){var o;if(e._options.view[i]){var s=document.createElement("div");s.className="pgly-wps--item";var r=document.createElement("strong");r.textContent=e._options.view[i];var a=document.createElement("span");a.textContent=(null!==(o=t.inputs[i].label)&&void 0!==o?o:t.inputs[i].value).toString(),s.appendChild(r),s.appendChild(a),n.appendChild(s);}}));var o=document.createElement("div");o.className="pgly-wps--action-bar inside right";var s=document.createElement("button");s.className="pgly-wps--button pgly-wps-is-compact pgly-wps-is-primary pgly-wps--edit",s.dataset.uid=t.uid,s.textContent=this._options.labels.edit;var r=document.createElement("button");r.className="pgly-wps--button pgly-wps-is-compact pgly-wps-is-danger pgly-wps--remove",r.dataset.uid=t.uid,r.textContent=this._options.labels.remove,o.appendChild(s),o.appendChild(r),i.appendChild(n),i.appendChild(o),this._comps.items.appendChild(i);},e.prototype._updateCard=function(t){var e=this,i=DOMManipulation.findElement(this._comps.items,'.pgly-wps--card[data-uid="'+t.uid+'"]');if(i){var n=DOMManipulation.findElement(i,".pgly-wps--content");if(n){for(;n.firstChild;)n.removeChild(n.firstChild);Object.keys(t.inputs).forEach((function(i){var o;if(e._options.view[i]){var s=document.createElement("div");s.className="pgly-wps--item";var r=document.createElement("strong");r.textContent=e._options.view[i];var a=document.createElement("span");a.textContent=(null!==(o=t.inputs[i].label)&&void 0!==o?o:t.inputs[i].value).toString(),s.appendChild(r),s.appendChild(a),n.appendChild(s);}}));}}},e.prototype._removeCard=function(t){var e=DOMManipulation.findElement(this._comps.items,'.pgly-wps--card[data-uid="'+t.uid+'"]');e&&this._comps.items.removeChild(e);},e.prototype._bind=function(){var t=this;this.on("beforeLoad",(function(){t._wrapper.classList.add("pgly-loading--state");})),this.on("afterLoad",(function(){t._wrapper.classList.remove("pgly-loading--state");})),this.on("submit",(function(){var e;return t._submit(t.prepare(null!==(e=t._options.rules)&&void 0!==e?e:{}))})),this.on("cancel",(function(){return t._cancel()})),this.on("added",(function(e){var i=e.item;t.field().set(t._items.all()),t._addCard(i);})),this.on("updated",(function(e){var i=e.item;t.field().set(t._items.all()),t._updateCard(i);})),this.on("updatedId",(function(e){var i=e.item;t.field().set(t._items.all()),t._updateCard(i);})),this.on("removed",(function(e){var i=e.item;t.field().set(t._items.all()),t._removeCard(i);})),this._comps.items.addEventListener("click",(function(e){var i=e.target;if(i.dataset.uid&&!t._loader.isLoading()){if(e.preventDefault(),i.classList.contains("pgly-wps--edit")){if(t._editing)return;return t._editing=!0,t._current=i.dataset.uid,void t._updateInputs(t._current)}if(i.classList.contains("pgly-wps--remove")){if(t._editing)return;t._items.remove(i.dataset.uid);}}})),DOMManipulation.findElement(this._wrapper,"button.pgly-gform--submit").addEventListener("click",(function(e){e.preventDefault(),t.emit("submit",{});})),DOMManipulation.findElement(this._wrapper,"button.pgly-gform--cancel").addEventListener("click",(function(e){e.preventDefault(),t.emit("cancel",{});}));},e.prototype._default=function(){this.field().set([]);},e}(PglyBaseComponent);

    var PglyBaseFormEngine=function(t){function e(e,n){var i;void 0===n&&(n={});var o=t.call(this)||this;return o._loading=!1,o._currentButtonClass=".pgly-form--submit",o._wrapper=DOMManipulation.getElement(e),o._inputs=null!==(i=n.inputs)&&void 0!==i?i:[],o._options=n,o._formatter=function(t){return qsStringify(t)},o._bind(),o}return __extends(e,t),e.prototype.changeSubmitButtonClass=function(t){this._currentButtonClass=t;},e.prototype.restoreSubmitButtonClass=function(){this._currentButtonClass=".pgly-form--submit";},e.prototype.formEl=function(){return this._wrapper},e.prototype.dataset=function(){return this._wrapper.dataset},e.prototype.formatter=function(t){this._formatter=t;},e.prototype.add=function(t){this._inputs.push(t);},e.prototype.get=function(t){return this._inputs.find((function(e){return e.field().name()===t}))},e.prototype.remove=function(t){this._inputs=this._inputs.filter((function(e){return e.field().name()!==t}));},e.prototype.auto=function(){var t=this,e="pgly-form";this._wrapper.querySelectorAll(".pgly-form--input").forEach((function(n){if(n.classList.contains(e+"--text"))t._inputs.push(new PglyInputComponent(n));else if(n.classList.contains(e+"--textarea"))t._inputs.push(new PglyTextAreaComponent(n));else if(n.classList.contains(e+"--checkbox"))t._inputs.push(new PglyCheckboxComponent(n));else if(n.classList.contains(e+"--select"))t._inputs.push(new PglyBasicSelectComponent(n));else if(n.classList.contains(e+"--eselect"))t._inputs.push(new PglySelectComponent(n));else if(n.classList.contains(e+"--finder"))t._inputs.push(new PglyFinderComponent(n));else if(n.classList.contains(e+"--single-media"))t._inputs.push(new PglySingleMediaComponent(n));else if(n.classList.contains(e+"--multiple-media"))t._inputs.push(new PglyMultipleMediaComponent(n));else if(n.classList.contains(e+"--group")){var i=new PglyGroupFormComponent(n);i.auto(),t._inputs.push(i);}}));},e.prototype.prepare=function(t){void 0===t&&(t={});var e={},n=[];return this._inputs.forEach((function(i){t[i.field().name()]&&(i.validate(t[i.field().name()]),i.error().has()&&n.push({name:i.field().name(),value:i.field().get(),message:i.error().message()})),e[i.field().name()]=i.field().get();})),{inputs:e,errors:n}},e.prototype.isLoading=function(){return this._loading},e.prototype.loadState=function(t){this._loading=t,this._wrapper.querySelectorAll(this._currentButtonClass).forEach((function(t){return t.classList.toggle("pgly-loading--state")}));},e.prototype._bind=function(){var t,e,n,i,o=this,r=null!==(e=null!==(t=this._wrapper.action)&&void 0!==t?t:this._wrapper.dataset.action)&&void 0!==e?e:"/",s=null!==(i=null!==(n=this._wrapper.method)&&void 0!==n?n:this._wrapper.dataset.method)&&void 0!==i?i:"POST";this._wrapper.addEventListener("submit",(function(t){var e;t.preventDefault(),o.submit(s,r,o.prepare(null!==(e=o._options.rules)&&void 0!==e?e:{}));})),this._wrapper.addEventListener("click",(function(t){var e;t.preventDefault();var n=t.target;n&&n.classList.contains("pgly-form--submit")&&o.submit(s,r,o.prepare(null!==(e=o._options.rules)&&void 0!==e?e:{}));}));},e}(EventHandler);var PglyAsyncFormEngine=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.submit=function(t,e,n){var i=this,o=__assign({},n);this._loading||(0===o.errors.length?(this.loadState(!0),o.inputs.xSecurity=this._options.x_security,this.emit("prepared",o),("POST"===t.toUpperCase()?axios__default["default"].post(e,this._formatter(o.inputs)):axios__default["default"].get(e,this._formatter(o.inputs))).then((function(t){i.emit("requestSuccess",{data:o.inputs,response:t.data});})).catch((function(t){i.emit("requestError",{data:o.inputs,error:t});})).finally((function(){i.loadState(!1),i.emit("requestEnd",{data:o.inputs}),i.restoreSubmitButtonClass();}))):this.emit("error",{data:o.errors}));},e}(PglyBaseFormEngine);

    var PglyToast=function(){function t(t){this._container=DOMManipulation.getElement(t);}return t.prototype.launch=function(t,e){var i=this,n=__assign({timer:2e3,type:"regular",light:!1},e),a=document.createElement("div");a.classList.add("pgly-wps--toast","pgly-wps-is-"+n.type),n.light&&a.classList.add("pgly-wps-is-light");var o=document.createElement("button");o.classList.add("pgly-wps--delete");var l=document.createElement("div");l.textContent=t,a.appendChild(o),a.appendChild(l),this._container.appendChild(a);var s=!1;setTimeout((function(){s||i._container.removeChild(a);}),n.timer),o.addEventListener("click",(function(){i._container.removeChild(a),s=!0;}));},t}();

    var wpSingleMediaFrame=PglySingleMediaComponent.wpFrame;var wpMultipleMediaFrame=PglyMultipleMediaComponent.wpFrame;var WPForm=function(){function t(t,r,o,e,n){var i=this;void 0===n&&(n=!1),this._rules={},this._group=!1,this.actions={};this._toaster=new PglyToast(r),this._rules=o,this._form=this._loadForm(t,null!=e?e:function(t){return i._applyData(t)},o),this._group=n;}return t.prototype.toaster=function(){return this._toaster},t.prototype.form=function(){return this._form},t.prototype.isOnPost=function(){var t,r=this;this._postForm=null!==(t=document.querySelector('form[name="post"]'))&&void 0!==t?t:void 0,this._postForm&&!this._group&&this._postForm.addEventListener("submit",(function(){r._form&&r._form.submit("POST",r._form.dataset().action,r._form.prepare(r._rules));}));},t.prototype.inOnMetabox=function(t,r,o,e,n,i){var s=this,a=this._form.get(t);a.options({view:n,labels:{edit:"Editar",remove:"Remover"},rules:i}),a.asynchronous((function(){return __awaiter(s,void 0,void 0,(function(){var t,o;return __generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,axios__default["default"].post(r,__assign(__assign({},this._form.dataset()),{x_security:e}))];case 1:return (t=n.sent().data).success?[2,t.data]:(this.onError({error:t.data}),[2,[]]);case 2:return o=n.sent(),this.onError({error:o}),[2,[]];case 3:return [2]}}))}))}));var u=function(t,r,o,n){return function(i){var u=i.item,d=i.origin;"load"!==d&&(u.inputs.id||"remove"!==d&&"update"!==d)&&(a.loader().prepare(),new Promise((function(o,n){var i={};Object.keys(u.inputs).forEach((function(t){i[t]=u.inputs[t].value;})),axios__default["default"].post(t,__assign(__assign(__assign(__assign({},s._form.dataset()),i),r),{x_security:e})).then((function(t){o(t.data);})).catch((function(t){n(t);}));})).then((function(t){var r;if(!t.success)return s.onError({error:t}),void n(u);s.onSuccess({response:t}),o(u,null!==(r=t.data.id)&&void 0!==r?r:void 0);})).catch((function(t){s.onError({error:t}),n(u);})).finally((function(){return a.loader().done()})));}};a.on("loadError",(function(t){var r=t.err;s.onError({error:r});})),a.on("added",u(o,{action:"add"},(function(t,r){a.items().updateId(t.uid,parseInt(r,10));}),(function(t){a.items().remove(t.uid);}))),a.on("updated",u(o,{action:"update"},(function(){return null}),(function(){return null}))),a.on("removed",u(o,{action:"remove"},(function(){return null}),(function(){return null}))),a.on("error",this._error.bind(this));},t.prototype.enableAction=function(t,r){var o=this;this.form().formEl().addEventListener("click",(function(e){e.target&&(e.target.classList.contains("pgly-form--"+t)&&(e.preventDefault(),r(o)));}));var e=new URLSearchParams(window.location.search).get("action");t===e&&r(this);},t.prototype.getUrl=function(t,r){return t+"?action="+r},t.prototype.loadFinder=function(t,r){var o=this;t.options({load:function(t){return __awaiter(o,void 0,void 0,(function(){var o,e;return __generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,axios__default["default"].post(r,__assign({query:t},this._form.dataset()))];case 1:return 0===(o=n.sent().data).data.length&&this._toaster.launch("Nenhum resultado encontrado...",{type:"danger",timer:2e3}),[2,o.data];case 2:return e=n.sent(),this.onError(e),[2,[]];case 3:return [2]}}))}))},labels:{select:"Selecionar",unselect:"Remover"}});},t.prototype._loadForm=function(t,r,o){var e=new PglyAsyncFormEngine(t,{rules:null!=o?o:{}});return e.formatter(r.bind(this)),e.on("error",this._error.bind(this)),e.on("requestSuccess",this.onSuccess.bind(this)),e.on("requestError",this.onError.bind(this)),e.auto(),e},t.prototype._applyData=function(t){if(!this._form)return t;var r=__assign({},t);return this._form.dataset().recordId&&(r.id=this._form.dataset().recordId),this._form.dataset().postId&&(r.post_id=this._form.dataset().postId),this._form.dataset().xSecurity&&(r.x_security=this._form.dataset().xSecurity),r},t.prototype._error=function(){this._toaster.launch("Campos inválidos, verifique antes de continuar",{type:"danger",timer:5e3});},t.prototype.onSuccess=function(t){var r=t.response;r.success?(this._toaster.launch(r.data.message,{type:"success",timer:5e3}),this._postForm&&this._postForm.submit(),r.data.id&&this._updateRecordId(r.data.id)):this._toaster.launch(r.data.message,{type:"danger",timer:5e3});},t.prototype.onError=function(t){var r,o,e,n,i,s,a,u=t.error;this._toaster.launch(null!==(a=null!==(s=null!==(n=null===(e=null===(o=null===(r=null==u?void 0:u.response)||void 0===r?void 0:r.data)||void 0===o?void 0:o.data)||void 0===e?void 0:e.message)&&void 0!==n?n:null===(i=null==u?void 0:u.data)||void 0===i?void 0:i.message)&&void 0!==s?s:u.message)&&void 0!==a?a:"Erro de execução do script",{type:"danger",timer:5e3});},t.prototype._getRecordId=function(){if(this._form)return this._form.dataset().recordId},t.prototype._updateRecordId=function(t){t&&this._form&&(this._form.formEl().dataset.recordId=t);},t}();

    var PglyNotification=function(){function t(t){this._container=DOMManipulation.getElement(t),this._bind();}return t.prototype.launch=function(t,e){var i=this,n=__assign({timer:2e3,type:"regular",light:!1},e),o=document.createElement("div");o.classList.add("pgly-wps--notification","pgly-wps-is-"+n.type),n.light&&o.classList.add("pgly-wps-is-light");var a=document.createElement("button");a.classList.add("pgly-wps--delete");var l=document.createElement("div");l.textContent=t,o.appendChild(a),o.appendChild(l),this._container.appendChild(o);var r=!1;setTimeout((function(){r||i._container.removeChild(o);}),n.timer),a.addEventListener("click",(function(){i._container.removeChild(o),r=!0;}));},t.prototype._bind=function(){document.querySelectorAll(".pgly-wps--notification .pgly-wps--delete").forEach((function(t){var e,i=t.parentNode,n=parseInt(null!==(e=i.dataset.timer)&&void 0!==e?e:"0",10),o=!1;n>0&&setTimeout((function(){var t;o||null===(t=null==i?void 0:i.parentNode)||void 0===t||t.removeChild(i);}),n),t.addEventListener("click",(function(){var t;o=!0,null===(t=null==i?void 0:i.parentNode)||void 0===t||t.removeChild(i);}));}));},t}();

    exports.PglyAsyncFormEngine = PglyAsyncFormEngine;
    exports.PglyBasicSelectComponent = PglyBasicSelectComponent;
    exports.PglyCheckboxComponent = PglyCheckboxComponent;
    exports.PglyFinderComponent = PglyFinderComponent;
    exports.PglyGroupFormComponent = PglyGroupFormComponent;
    exports.PglyInputComponent = PglyInputComponent;
    exports.PglyMultipleMediaComponent = PglyMultipleMediaComponent;
    exports.PglyNotification = PglyNotification;
    exports.PglySelectComponent = PglySelectComponent;
    exports.PglySingleMediaComponent = PglySingleMediaComponent;
    exports.PglyTextAreaComponent = PglyTextAreaComponent;
    exports.PglyToast = PglyToast;
    exports.WPForm = WPForm;
    exports.wpMultipleMediaFrame = wpMultipleMediaFrame;
    exports.wpSingleMediaFrame = wpSingleMediaFrame;

    Object.defineProperty(exports, '__esModule', { value: true });

}));
